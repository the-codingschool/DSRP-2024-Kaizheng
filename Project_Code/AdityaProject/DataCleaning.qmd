# Are accidents caused more by certain demographics? Gender, age, income}

# 

# Are accidents caused more by certain types of cars?

# 

# Are accidents happening more at certain times of the day? Divide day into 3 hr windows maybe

# 

# Are accidents happening more in certain areas of the streets? Intersections, freeways, regular portion of the streets? And what speed limit zones?

# 

# What % are caused due to speeding? Any other reason stands out?

# 

# How many cars on average ( daily /monthly/ annually ) get involved in accidents ( responsible or not )

# 

# Is there any trend where and what times - multiple car ( 3 or more cars ) accidents happen?

# 

# How many accidents are single car accidents? What are the main causes?

```{r}

#install.packages("readr")
library(readr)
library(dplyr)
library(janitor)

getwd()

traffic <- read.csv("Project_Code/Data/data_traffic.csv")


traffic

```

```{r}
## Visualizing some basic data

library(ggplot2)


#By month
ggplot(data = traffic, aes(x=month)) + geom_bar()


#By year
ggplot(data = traffic, aes(x=accident_year)) + geom_bar()


#By gender
pie(table(traffic$party_sex))


#Injury types
pie(table(traffic$collision_severity))


#Time of day

pie(table(traffic$time_cat))


```

```{r}
## This will only focus on who caused accidents

accidenters <- subset(traffic, at_fault == "Yes")

#head(accidenters)

accidenters

pie(table(accidenters$race))



#by_age <- subset(accidenters, !is.na(party_age))
#by_age <- subset(by_age, party_age > 15)      

by_age <- filter(accidenters, party_age > 0)

#by_age

##Histogram by age and subdivided by gender
ggplot(data = by_age, aes(x=party_age, fill = factor(party_sex))) + geom_histogram()


```

```{r}


#Compares the types of vehicle
ggplot(traffic, aes(stwd_vehicle_type)) + geom_bar() + theme(axis.text.x = element_text(angle = 90))




primary_streets <- get_dupes(accidenters, primary_rd)
primary_streets 

secondary_streets <- get_dupes(accidenters, secondary_rd)
secondary_streets



important_street <- "MISSION ST"


acc_on_imp <- subset(accidenters, primary_rd == important_street)

acc_on_imp


ggplot(acc_on_imp, aes(vz_pcf_description)) + geom_bar()





count(acc_on_imp, vz_pcf_description)

#62 Driver or Bicyclist to yield right-of-way at crosswalks
#41 Following too closely prohibited
#31 illegal U turn in business district
#68 Red signal - driver or bicyclist responsibilities
#93 Unsafe speed for prevailing conditions
#73 unsafe turn or lange change prohibited
#43 Violation of right of way - left turn


count(acc_on_imp, distance == 0)

#354 incidents at intersection, 294 not at intersection

```

```{r}
#people_demo <- select(traffic, c(party_type, at_fault, party_sex, party_age, party_sobriety, race))

people_demo <- select(traffic, c(at_fault, party_sex, party_age, party_sobriety, race))

people_demo <- filter(people_demo, !is.na(party_age))

#people_demo

#count(people_demo, party_type)

#count(people_demo, party_sex)

#count(people_demo, party_sobriety)

#count(people_demo, race)

people_demo_changed <- people_demo


people_demo_changed$party_sex <- replace(people_demo_changed$party_sex, people_demo_changed$party_sex == "Male", 1)
people_demo_changed$party_sex <- replace(people_demo_changed$party_sex, people_demo_changed$party_sex == "Female", 2)
people_demo_changed$party_sex <- replace(people_demo_changed$party_sex, people_demo_changed$party_sex == "Not Stated", 3)
people_demo_changed$party_sex <- replace(people_demo_changed$party_sex, people_demo_changed$party_sex == "Other", 4)

people_demo_changed$party_sex <- as.numeric(people_demo_changed$party_sex)

#Male - 1
#Female - 2
#Not stated - 3
#Other - 4


#people_demo_changed$party_type <- replace(people_demo_changed$party_type, people_demo_changed$party_type == "Driver", 1)
#people_demo_changed$party_type <- replace(people_demo_changed$party_type, people_demo_changed$party_type == "Bicyclist", 2)
#people_demo_changed$party_type <- replace(people_demo_changed$party_type, people_demo_changed$party_type == "Pedestrian", 3)
#people_demo_changed$party_type <- replace(people_demo_changed$party_type, people_demo_changed$party_type == "Other", 5)
#people_demo_changed$party_type <- replace(people_demo_changed$party_type, people_demo_changed$party_type == "Parked Vehicle", 4)

#people_demo_changed$party_type <- as.numeric(people_demo_changed$party_type)

#Driver - 1
#Bicyclist - 2
#Pedestrian - 3
#Parked Vehicle - 4
#Other - 5



people_demo_changed$party_sobriety <- replace(people_demo_changed$party_sobriety, people_demo_changed$party_sobriety == "Had Been Drinking, Impairment Unknown", 1)
people_demo_changed$party_sobriety <- replace(people_demo_changed$party_sobriety, people_demo_changed$party_sobriety == "Had Been Drinking, Not Under Influence", 2)
people_demo_changed$party_sobriety <- replace(people_demo_changed$party_sobriety, people_demo_changed$party_sobriety == "Had Been Drinking, Under Influence", 3)
people_demo_changed$party_sobriety <- replace(people_demo_changed$party_sobriety, people_demo_changed$party_sobriety == "Had Not Been Drinking", 4)
people_demo_changed$party_sobriety <- replace(people_demo_changed$party_sobriety, people_demo_changed$party_sobriety %in% c("Impairment Not Known", "Not Applicable", "Not Stated"), 5)

people_demo_changed$party_sobriety <- as.numeric(people_demo_changed$party_sobriety)


#Had Been Drinking, Impairment Unknown - 1
#Had Been Drinking, Not Under Influence	- 2
#Had Been Drinking, Under Influence	- 3
#Had Not Been Drinking - 4
#Impairment Not Known, Not Applicable, Not Stated	- 5




people_demo_changed$race <- replace(people_demo_changed$race, people_demo_changed$race == "Asian", 1)
people_demo_changed$race <- replace(people_demo_changed$race, people_demo_changed$race == "Black", 2)
people_demo_changed$race <- replace(people_demo_changed$race, people_demo_changed$race == "Hispanic", 3)
people_demo_changed$race <- replace(people_demo_changed$race, people_demo_changed$race == "White", 4)
people_demo_changed$race <- replace(people_demo_changed$race, people_demo_changed$race %in% c("Other", "Not Stated"), 5)

people_demo_changed$race <- as.numeric(people_demo_changed$race)

#Asian - 1
#Black - 2
#Hispanic - 3
#White - 4
#Other, Not Stated - 5


people_demo_changed$at_fault <- replace(people_demo_changed$at_fault, people_demo_changed$at_fault == "No", 0)
people_demo_changed$at_fault <- replace(people_demo_changed$at_fault, people_demo_changed$at_fault == "Yes", 1)

people_demo_changed$at_fault <- as.numeric(people_demo_changed$at_fault)


#Yes - 1
#No - 0

#is.numeric(people_demo_changed$at_fault[0])

#people_demo_changed$at_fault[c("Yes", "No")] <- c(0, 1)






people_demo

people_demo_changed





```
